<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Markdown Preview</title>
  <style>

    a{text-decoration:none;}

    p{margin:1em 0;}

    img{max-width:100%;}

    h1,h2,h3,h4,h5,h6{font-weight:normal;color:#111;line-height:1em;}
    h4,h5,h6{ font-weight: bold; }
    h1{ font-size:2.5em; }
    h2{ font-size:2em; border-bottom:1px solid silver; padding-bottom: 5px; }
    h3{ font-size:1.5em; }
    h4{ font-size:1.2em; }
    h5{ font-size:1em; }
    h6{ font-size:0.9em; }

    blockquote{color:#666666;margin:0;padding-left: 3em;border-left: 0.5em #EEE solid;}
    hr { display: block; height: 2px; border: 0; border-top: 1px solid #aaa;border-bottom: 1px solid #eee; margin: 1em 0; padding: 0; }

    pre, code{
      color: #000;
      font-family: monospace;
      font-size: 0.88em;
      border-radius:3px;
      background-color: #F8F8F8;
      border: 1px solid #CCC;
    }
    pre { white-space: pre; white-space: pre-wrap; word-wrap: break-word; padding: 5px;}
    pre code { border: 0px !important; background: transparent !important; line-height: 1.3em; }
    sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
    sup { top: -0.5em; }
    sub { bottom: -0.25em; }
    ul, ol { margin: 1em 0; padding: 0 0 0 2em; }
    li p:last-child { margin:0 }
    dd { margin: 0 0 0 2em; }
    img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; }
    table { border-collapse: collapse; border-spacing: 0; }
    td, th { vertical-align: top; padding: 4px 10px; border: 1px solid #bbb; }
    tr:nth-child(even) td, tr:nth-child(even) th { background: #eee; }

    ins { text-decoration: none; color: green }
    del { text-decoration: none; color: red }
    ins a{ color: green; text-decoration:none; }
    del a{ color: red; text-decoration: none; }

  </style>

  <script>

    var smooth_scroll_to = function(target, duration) {
        target = Math.round(target);
        duration = Math.round(duration);
        if (duration === 0) {
            window.scrollTo(0, target);
            return
        }

        var start_time = Date.now();
        var end_time = start_time + duration;

        var start_top = document.documentElement.scrollTop || document.body.scrollTop
        var distance = target - start_top;

        // based on http://en.wikipedia.org/wiki/Smoothstep
        var smooth_step = function(start, end, point) {
            if(point <= start) { return 0; }
            if(point >= end) { return 1; }
            var x = (point - start) / (end - start); // interpolation
            return x*x*(3 - 2*x);
        }

        // This is to keep track of where the window's scrollTop is
        // supposed to be, based on what we're doing
        var previous_top = document.documentElement.scrollTop || document.body.scrollTop

        // This is like a think function from a game loop
        var scroll_frame = function() {
            var tmp = document.documentElement.scrollTop || document.body.scrollTop
            if(tmp != previous_top) {
                reject("interrupted");
                return;
            }

            // set the scrollTop for this frame
            var now = Date.now();
            var point = smooth_step(start_time, end_time, now);
            var frameTop = Math.round(start_top + (distance * point));
            window.scrollTo(0, frameTop);

            // check if we're done!
            if(now >= end_time) {
                resolve();
                return;
            }

            // If we were supposed to scroll but didn't, then we
            // probably hit the limit, so consider it done; not
            // interrupted.
            var tmp = document.documentElement.scrollTop || document.body.scrollTop
            if(tmp === previous_top
                && tmp !== frameTop) {
                resolve();
                return;
            }
            previous_top = tmp;

            // schedule next frame for execution
            setTimeout(scroll_frame, 0);
        }

        // boostrap the animation process
        setTimeout(scroll_frame, 0);
    }

    var last_html = undefined;

    /** Function count the occurrences of substring in a string;
     * @param {String} string   Required. The string;
     * @param {String} subString    Required. The string to search for;
     * @param {Boolean} allowOverlapping    Optional. Default: false;
     */
    function occurrences(string, subString, allowOverlapping){

        string+=""; subString+="";
        if(subString.length<=0) return string.length+1;

        var n=0, pos=0;
        var step=(allowOverlapping)?(1):(subString.length);

        while(true){
            pos=string.indexOf(subString,pos);
            if(pos>=0){
                n++; pos+=step;
            } else
                break;
        }
        return(n);
    }

    function unescape1(data) {
        return decodeURIComponent(escape(window.atob(data)))
    }

    /* TODO: highligh the W */
    /* TODO: scroll to W exactly */
    function setCursor(W, C) {
        W = unescape1(W);
        var d = document.getElementById('out');
        for (var i = 0; i < d.childNodes.length; i++) {
            f = occurrences(d.childNodes[i].textContent, W, false);
            C = C - f;
            if (C <= 0) {
                smooth_scroll_to(d.childNodes[i].offsetTop - window.outerHeight / 3, 500)
                return;
            }
        }
    }

    function setOutput(val){
        val = unescape1(val)
        var out = document.getElementById('out');
        out.innerHTML = val;
    }
  </script>
</head>
<body>
  <div id=out />
</body>
</html>

